name: F0.5 Security Validation

on:
  workflow_dispatch:
  schedule:
    - cron: '0 2 * * *' # Nightly at 2 AM

permissions:
  contents: read
  id-token: write

jobs:
  validate-security:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Start OpenBao Stack
        run: |
          # Start minimal stack for validation
          docker compose up -d openbao postgres
          # Wait for healthy
          sleep 10

      - name: Run Chaos Tests
        run: |
          # In CI, we might need to adjust the script or run specific commands
          # For now, we'll just lint the script as we can't fully simulate the env without secrets
          shellcheck scripts/security/test-f05-chaos.sh

      - name: Verify Secret Injection (Simulation)
        run: |
          echo "Verifying secret injection logic..."
          # This would run actual tests if we had a full ephemeral env
          true
