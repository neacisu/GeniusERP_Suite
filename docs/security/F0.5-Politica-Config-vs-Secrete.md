# Politica de Guvernanță: Configurație vs. Secrete

**Data:** 21 Noiembrie 2025
**Referință:** F0.5.2
**Status:** Activă

## 1. Scop și Aplicabilitate

Această politică definește regulile stricte pentru clasificarea, denumirea și stocarea variabilelor de mediu în cadrul suitei GeniusERP. Ea se aplică tuturor dezvoltatorilor, inginerilor DevOps și proceselor automate (CI/CD).

**Obiectiv:** Eliminarea completă a secretelor din Git și de pe disk, asigurând în același timp o experiență de dezvoltare fluidă.

## 2. Matricea de Clasificare

Orice variabilă de mediu trebuie clasificată într-una din cele două categorii: **Configurație** sau **Secret**.

| Criteriu | Configurație (Git) | Secret (OpenBao) |
| :--- | :--- | :--- |
| **Definiție** | Informație necesară rulării, non-confidențială. | Informație care conferă acces sau autoritate. |
| **Impact Scurgere** | Scăzut (ex: se află portul intern). | Critic (ex: acces la baza de date de producție). |
| **Stocare Dev** | `.env` (comis în Git dacă e comun) | OpenBao Dev Server / Vault Local |
| **Stocare Prod** | `docker-compose.yml` / ConfigMap | OpenBao KV / Dynamic Secrets |
| **Exemple** | `PORT`, `LOG_LEVEL`, `NODE_ENV`, `PUBLIC_URL` | `DB_PASS`, `API_KEY`, `JWT_SECRET`, `TLS_KEY` |

### 2.1 Cazuri Speciale (Zone Gri)

- **URL-uri Interne:** Deși conțin informații despre arhitectură, sunt considerate **Configurație** (`SVC_URL`).
- **Feature Flags:** Sunt **Configurație**, gestionate prin variabile sau serviciu dedicat.
- **Public Keys:** Sunt **Configurație** (nu permit decriptare/semnare).

## 3. Standarde de Naming

Se aplică strict convenția definită în `Strategii de Fișiere.env și Porturi.md`:

`[PREFIX_COMPONENTĂ]_[CATEGORIE]_[NUME_DESCRIPTIV]`

### 3.1 Prefix Componentă (Exemple)

- `SUITE_`: Global
- `NUMQ_`: Numeriqo
- `CP_IDT_`: Identity
- `GW_`: Gateway

### 3.2 Categorie (Exemple)

- `DB_`: Baze de date
- `AUTH_`: Autentificare
- `API_`: Integrări externe
- `APP_`: Configurații specifice

**Exemplu Corect:** `NUMQ_DB_PASSWORD` (Secret), `NUMQ_APP_PORT` (Config)
**Exemplu Incorect:** `DB_PASS` (Ambiguu), `NUMERIQO_PORT` (Prefix greșit)

## 4. Fluxuri de Lucru (Workflow)

### 4.1 Adăugarea unei Configurații Noi

1. Definiți variabila în `docker-compose.yml` (sau `.env.example`).
2. Setați o valoare implicită sigură (dacă e posibil).
3. Comiteți modificarea în Git.

### 4.2 Adăugarea unui Secret Nou

1. **NU** adăugați valoarea în niciun fișier din repo.
2. Adăugați cheia în `env/openbao.template.hcl` (sau echivalentul `.ctmpl`).
3. Adăugați valoarea în OpenBao KV:

    ```bash
    bao kv put secret/data/numeriqo/config DB_PASS=supersecret
    ```

4. În Dev: Folosiți scriptul de seed sau interfața UI OpenBao.

## 5. Checklist Code Review (Security Gate)

Orice Pull Request trebuie verificat pentru următoarele:

- [ ] **Nu există secrete hardcodate** în cod sau în fișiere de configurare.
- [ ] **Nu există fișiere .env** comise (verificați `.gitignore`).
- [ ] Variabilele noi respectă **Naming Convention**.
- [ ] Secretele noi sunt documentate ca necesitate, dar valorile nu sunt prezente.
- [ ] Logurile nu expun variabile sensibile (ex: nu `console.log(process.env)`).

## 6. Sancțiuni și Remedieri

Încălcarea acestei politici (ex: comiterea unui secret) duce la:

1. **Revocarea imediată** a secretului compromis.
2. **Rotirea credențialelor** afectate.
3. **Squash commit / History rewrite** (dacă este posibil și sigur) sau ștergerea repo-ului și re-clonare în cazuri grave.
